---
title: "Ch4_frag_results_plots&layouts"
author: "Mikaela Nordborg"
date: "22/03/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#For model fitting, evaluation & extraction of results
library(dplyr)
library(bayesnec) #devtools::install_github("open-AIMS/bayesnec")
require(tidyverse)
library(beepr)
inv.log10 <- function(x){10^x}

#For graphical representation of results
library(ggplot2)
library(tidybayes)
library(ggpubr)
```




# Full MANEC model fits
##Load files and create result plots

### Pyrene
#### 2019.11
```{r}
load("2019.11_Tol_data_frag48_filtered.RData")
load("2019.11_Tol_frag48_predvals.RData")

p.all= ggplot()
p.all= p.all+ scale_color_manual(values = c("UVR" = "steelblue", "PAR" = "seagreen")) + theme_light()


#p.all= p.all+  geom_ribbon(aes(x=10^pred.Tol.19Nov.frag48.PAR.inv$x, ymin=pred.Tol.19Nov.frag48.PAR.inv$Q2.5, ymax=pred.Tol.19Nov.frag48.PAR.inv$Q97.5, fill="seagreen"),  alpha=0.3) #Seagreen HEX code: #2e8b57
#p.all= p.all+  scale_fill_manual(values=c("seagreen", "steelblue"))
p.all= p.all+  geom_ribbon(aes(x=10^pred.Tol.19Nov.frag48.UV.inv$x, ymin=pred.Tol.19Nov.frag48.UV.inv$Q2.5, ymax=pred.Tol.19Nov.frag48.UV.inv$Q97.5, fill="steelblue",  alpha=0.3))
#p.all= p.all+  scale_fill_manual(values="steelblue")


#p.all= p.all+ geom_line(aes(x=10^pred.Tol.19Nov.frag48.PAR.inv$x, y=pred.Tol.19Nov.frag48.PAR.inv$Estimate), color = 'grey30', size=0.5)
p.all= p.all+ geom_line(aes(x=10^pred.Tol.19Nov.frag48.UV.inv$x, y=pred.Tol.19Nov.frag48.UV.inv$Estimate), color = 'grey30', size=0.5)


p.all= p.all+ geom_point(data = data.Tol.19Nov.frag48.PAR, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2.5, position=position_jitter(width = .025, height=0.02))
p.all= p.all+ geom_point(data = data.Tol.19Nov.frag48.UV, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2, position=position_jitter(width = .025, height=0.02))


p.all = p.all+ labs(x=expression(), #Concentration~(μg~"L"^{-1})
              y=expression(48~h~fragmentation~("%")),
              subtitle="a) Toluene")
p.all= p.all+ scale_y_continuous( limits = c(-0.03, 1.05), breaks = c(0, 0.25, 0.5, 0.75, 1.0), labels = c(0, 25, 50, 75, 100)) 
p.all= p.all+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))
p.all= p.all+ scale_fill_manual(values = c("steelblue", "seagreen"))
p.all= p.all+ theme(legend.position="none")
# p.all = p.all  + theme(legend.position = c(0.9, 0.9))
p.all= p.all+ scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000))
#p.all= p.all+ facet_wrap(~factor, nrow = 1)


#Rename & show plot
plot.Tol.19Nov.frag48.all <- p.all
plot.Tol.19Nov.frag48.all
```

No EC50 could be derived for -UV therefore there is no posterior probability density plot available.


### Naphthalene
#### 2018.12
```{r}
load("2018.12_Nap_data_frag48_filtered.RData")
load("2018.12_Nap_frag48_predvals.RData")

p.all= ggplot()
p.all= p.all+ scale_color_manual(values = c("UVR" = "steelblue", "PAR" = "seagreen")) + theme_light()


p.all= p.all+  geom_ribbon(aes(x=10^pred.Nap.18Dec.frag48.PAR.inv$x, ymin=pred.Nap.18Dec.frag48.PAR.inv$Q2.5, ymax=pred.Nap.18Dec.frag48.PAR.inv$Q97.5, fill="seagreen"),  alpha=0.3) #Seagreen HEX code: #2e8b57
#p.all= p.all+  scale_fill_manual(values=c("seagreen", "steelblue"))
p.all= p.all+  geom_ribbon(aes(x=10^pred.Nap.18Dec.frag48.UV.inv$x, ymin=pred.Nap.18Dec.frag48.UV.inv$Q2.5, ymax=pred.Nap.18Dec.frag48.UV.inv$Q97.5, fill="steelblue",  alpha=0.3))
#p.all= p.all+  scale_fill_manual(values="steelblue")


p.all= p.all+ geom_line(aes(x=10^pred.Nap.18Dec.frag48.PAR.inv$x, y=pred.Nap.18Dec.frag48.PAR.inv$Estimate), color = 'grey30', size=0.5)
p.all= p.all+ geom_line(aes(x=10^pred.Nap.18Dec.frag48.UV.inv$x, y=pred.Nap.18Dec.frag48.UV.inv$Estimate), color = 'grey30', size=0.5)


p.all= p.all+ geom_point(data = data.Nap.18Dec.frag48.PAR, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2.5, position=position_jitter(width = .025, height=0.02))
p.all= p.all+ geom_point(data = data.Nap.18Dec.frag48.UV, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2, position=position_jitter(width = .025, height=0.02))


p.all = p.all+ labs(x=expression(), #Concentration~(μg~"L"^{-1})
              y=expression(), #48~h~fragmentation~("%")
              subtitle="b) Naphthalene")
p.all= p.all+ scale_y_continuous( limits = c(-0.03, 1.05), breaks = c(0, 0.25, 0.5, 0.75, 1.0), labels = c(0, 25, 50, 75, 100)) 
p.all= p.all+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))
p.all= p.all+ scale_fill_manual(values = c("seagreen", "steelblue"))
p.all= p.all+ theme(legend.position="none")
# p.all = p.all  + theme(legend.position = c(0.9, 0.9))
p.all= p.all+ scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000))
#p.all= p.all+ facet_wrap(~factor, nrow = 1)


#Rename & show plot
plot.Nap.18Dec.frag48.all <- p.all
plot.Nap.18Dec.frag48.all
```

No EC50s could be derived therefore there is no posterior probabilty plot available.


### 1-methylnaphthalene
#### 2019.11
```{r}
load("2019.11_1MN_data_frag48_filtered.RData")
load("2019.11_1MN_frag48_predvals.RData")

p.all= ggplot()
p.all= p.all+ scale_color_manual(values = c("UVR" = "steelblue", "PAR" = "seagreen")) + theme_light()


p.all= p.all+  geom_ribbon(aes(x=10^pred.1MN.19Nov.frag48.PAR.inv$x, ymin=pred.1MN.19Nov.frag48.PAR.inv$Q2.5, ymax=pred.1MN.19Nov.frag48.PAR.inv$Q97.5, fill="seagreen"),  alpha=0.3) #Seagreen HEX code: #2e8b57
#p.all= p.all+  scale_fill_manual(values=c("seagreen", "steelblue"))
p.all= p.all+  geom_ribbon(aes(x=10^pred.1MN.19Nov.frag48.UV.inv$x, ymin=pred.1MN.19Nov.frag48.UV.inv$Q2.5, ymax=pred.1MN.19Nov.frag48.UV.inv$Q97.5, fill="steelblue",  alpha=0.3))
#p.all= p.all+  scale_fill_manual(values="steelblue")


p.all= p.all+ geom_line(aes(x=10^pred.1MN.19Nov.frag48.PAR.inv$x, y=pred.1MN.19Nov.frag48.PAR.inv$Estimate), color = 'grey30', size=0.5)
p.all= p.all+ geom_line(aes(x=10^pred.1MN.19Nov.frag48.UV.inv$x, y=pred.1MN.19Nov.frag48.UV.inv$Estimate), color = 'grey30', size=0.5)


p.all= p.all+ geom_point(data = data.1MN.19Nov.frag48.PAR, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2.5, position=position_jitter(width = .025, height=0.02))
p.all= p.all+ geom_point(data = data.1MN.19Nov.frag48.UV, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2, position=position_jitter(width = .025, height=0.02))


p.all = p.all+ labs(x=expression(), #Concentration~(μg~"L"^{-1})
              y=expression(48~h~fragmentation~("%")),
              subtitle="c) 1-methylnaphthalene")
p.all= p.all+ scale_y_continuous( limits = c(-0.03, 1.05), breaks = c(0, 0.25, 0.5, 0.75, 1.0), labels = c(0, 25, 50, 75, 100)) 
p.all= p.all+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))
p.all= p.all+ scale_fill_manual(values = c("seagreen", "steelblue"))
p.all= p.all+ theme(legend.position="none")
# p.all = p.all  + theme(legend.position = c(0.9, 0.9))
p.all= p.all+ scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000))
#p.all= p.all+ facet_wrap(~factor, nrow = 1)


#Rename & show plot
plot.1MN.19Nov.frag48.all <- p.all
plot.1MN.19Nov.frag48.all
```

No EC50s could be derived therefore there is no posterior probability plot available.


### Phenanthrene
#### 2018.11
```{r}
load("2018.11_Phe_data_frag48_filtered.RData")
#load("2018.11_Phe_frag48_predvals.RData")

p.all= ggplot()
p.all= p.all+ scale_color_manual(values = c("UVR" = "steelblue", "PAR" = "seagreen")) + theme_light()


#p.all= p.all+  geom_ribbon(aes(x=10^pred.Phe.18Nov.frag48.PAR.inv$x, ymin=pred.Phe.18Nov.frag48.PAR.inv$Q2.5, ymax=pred.Phe.18Nov.frag48.PAR.inv$Q97.5, fill="seagreen"),  alpha=0.3) #Seagreen HEX code: #2e8b57
#p.all= p.all+  scale_fill_manual(values=c("seagreen", "steelblue"))
#p.all= p.all+  geom_ribbon(aes(x=10^pred.Phe.18Nov.frag48.UV.inv$x, ymin=pred.Phe.18Nov.frag48.UV.inv$Q2.5, ymax=pred.Phe.18Nov.frag48.UV.inv$Q97.5, fill="steelblue",  alpha=0.3))
#p.all= p.all+  scale_fill_manual(values="steelblue")


#p.all= p.all+ geom_line(aes(x=10^pred.Phe.18Nov.frag48.PAR.inv$x, y=pred.Phe.18Nov.frag48.PAR.inv$Estimate), color = 'grey30', size=0.5)
#p.all= p.all+ geom_line(aes(x=10^pred.Phe.18Nov.frag48.UV.inv$x, y=pred.Phe.18Nov.frag48.UV.inv$Estimate), color = 'grey30', size=0.5)


p.all= p.all+ geom_point(data = data.Phe.18Nov.frag48.PAR, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2.5, position=position_jitter(width = .025, height=0.02))
p.all= p.all+ geom_point(data = data.Phe.18Nov.frag48.UV, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2, position=position_jitter(width = .025, height=0.02))


p.all = p.all+ labs(x=expression(), #Concentration~(μg~"L"^{-1})
              y=expression(), #48~h~fragmentation~("%")
              subtitle="d) Phenanthrene")
p.all= p.all+ scale_y_continuous( limits = c(-0.03, 1.05), breaks = c(0, 0.25, 0.5, 0.75, 1.0), labels = c(0, 25, 50, 75, 100)) 
p.all= p.all+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))
p.all= p.all+ scale_fill_manual(values = c("seagreen", "steelblue"))
p.all= p.all+ theme(legend.position="none")
# p.all = p.all  + theme(legend.position = c(0.9, 0.9))
p.all= p.all+ scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000))
#p.all= p.all+ facet_wrap(~factor, nrow = 1)


#Rename & show plot
plot.Phe.18Nov.frag48.all <- p.all
plot.Phe.18Nov.frag48.all
```

No candidate models could be fitted therefore there is no EC50 posterior probability density plot available.


### Anthracene
#### 2017.12
Full subset MANEC
```{r}
load("2017.12_Ant_data_frag48_filtered.RData")
load("2017.12_Ant_frag48_predvals.RData")

p.all= ggplot()
p.all= p.all+ scale_color_manual(values = c("UVR" = "steelblue", "PAR" = "seagreen")) + theme_light()


p.all= p.all+  geom_ribbon(aes(x=10^pred.Ant.17Dec.frag48.PAR.inv$x, ymin=pred.Ant.17Dec.frag48.PAR.inv$Q2.5, ymax=pred.Ant.17Dec.frag48.PAR.inv$Q97.5, fill="seagreen"),  alpha=0.3) #Seagreen HEX code: #2e8b57
#p.all= p.all+  scale_fill_manual(values=c("seagreen", "steelblue"))
p.all= p.all+  geom_ribbon(aes(x=10^pred.Ant.17Dec.frag48.UV.inv$x, ymin=pred.Ant.17Dec.frag48.UV.inv$Q2.5, ymax=pred.Ant.17Dec.frag48.UV.inv$Q97.5, fill="steelblue",  alpha=0.3))
#p.all= p.all+  scale_fill_manual(values="steelblue")


p.all= p.all+ geom_line(aes(x=10^pred.Ant.17Dec.frag48.PAR.inv$x, y=pred.Ant.17Dec.frag48.PAR.inv$Estimate), color = 'grey30', size=0.5)
p.all= p.all+ geom_line(aes(x=10^pred.Ant.17Dec.frag48.UV.inv$x, y=pred.Ant.17Dec.frag48.UV.inv$Estimate), color = 'grey30', size=0.5)


p.all= p.all+ geom_point(data = data.Ant.17Dec.frag48.PAR, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2.5, position=position_jitter(width = .025, height=0.02))
p.all= p.all+ geom_point(data = data.Ant.17Dec.frag48.UV, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2, position=position_jitter(width = .025, height=0.02))


p.all = p.all+ labs(x=expression(Concentration~(μg~"L"^{-1})), #
              y=expression(48~h~fragmentation~("%")),
              subtitle="e) Anthracene")
p.all= p.all+ scale_y_continuous( limits = c(-0.03, 1.05), breaks = c(0, 0.25, 0.5, 0.75, 1.0), labels = c(0, 25, 50, 75, 100)) 
p.all= p.all+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))
p.all= p.all+ scale_fill_manual(values = c("seagreen", "steelblue"))
p.all= p.all+ theme(legend.position="none")
# p.all = p.all  + theme(legend.position = c(0.9, 0.9))
p.all= p.all+ scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000))
#p.all= p.all+ facet_wrap(~factor, nrow = 1)


#Rename & show plot
plot.Ant.17Dec.frag48.all <- p.all
plot.Ant.17Dec.frag48.all
```

```{r}
load("2017.12_Ant_frag48_posterior_comp_EC50.RData")

p.comp.EC50 = ggplot(comp.Ant.17Dec.frag48.EC50$posterior_data, aes(x=value))+geom_density(aes(group=model, color=model, fill=model), alpha=0.4) 
p.comp.EC50 = p.comp.EC50 + stat_pointinterval(aes(y = 0.00, x = value, group=model),.width = c(.66, .95), size=0.5)+
  theme_light()

p.comp.EC50 = p.comp.EC50 + scale_fill_manual( values = c("seagreen", "steelblue")) +
  scale_color_manual(values = c("grey","grey", "steelblue1","steelblue", "grey","grey", "grey","grey"))+theme(legend.position="none")
p.comp.EC50 = p.comp.EC50 + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))

p.comp.EC50 = p.comp.EC50 + scale_y_continuous(limits = c(-0.5, 16), name ="Posterior probability density") 
p.comp.EC50 = p.comp.EC50 + scale_x_continuous(limits = c(-1.02, 4.3), breaks = c(-1, 0, 1, 2, 3, 4), labels = c(0, 1, 10, 100, 1000, 10000)) #update breaks+labels to match the scale given by the automatic compare_posterior output
p.comp.EC50 = p.comp.EC50 + labs(x=expression(), #EC50~(μg~"L"^{-1})
               subtitle="b)")

p.comp.EC50= p.comp.EC50+ annotate("text", label = expression(Probability~of~EC[50]~difference), x = 0.55, y = 10.3, size = 2.8, colour = "grey20") #0.8 of the max y-axis limit
p.comp.EC50= p.comp.EC50+ annotate("text", label = "UVR < PAR = 91.05%", x = 0.55, y = 8.86, size = 2.4, colour = "grey20") #0.906 of the first annotation


#Rename & show plot
comp.plot.Ant.17Dec.frag48.EC50 <- p.comp.EC50
comp.plot.Ant.17Dec.frag48.EC50
```


### Pyrene
#### 2017.12
Full subset MANEC
```{r}
load("2017.11_Pyr_data_frag48_filtered.RData")
load("2017.11_Pyr_frag48_predvals.RData")

p.all= ggplot()
p.all= p.all+ scale_color_manual(values = c("UVR" = "steelblue", "PAR" = "seagreen")) + theme_light()


p.all= p.all+  geom_ribbon(aes(x=10^pred.Pyr.17Nov.frag48.PAR.inv$x, ymin=pred.Pyr.17Nov.frag48.PAR.inv$Q2.5, ymax=pred.Pyr.17Nov.frag48.PAR.inv$Q97.5, fill="seagreen"),  alpha=0.3) #Seagreen HEX code: #2e8b57
#p.all= p.all+  scale_fill_manual(values=c("seagreen", "steelblue"))
p.all= p.all+  geom_ribbon(aes(x=10^pred.Pyr.17Nov.frag48.UV.inv$x, ymin=pred.Pyr.17Nov.frag48.UV.inv$Q2.5, ymax=pred.Pyr.17Nov.frag48.UV.inv$Q97.5, fill="steelblue",  alpha=0.3))
#p.all= p.all+  scale_fill_manual(values="steelblue")


p.all= p.all+ geom_line(aes(x=10^pred.Pyr.17Nov.frag48.PAR.inv$x, y=pred.Pyr.17Nov.frag48.PAR.inv$Estimate), color = 'grey30', size=0.5)
p.all= p.all+ geom_line(aes(x=10^pred.Pyr.17Nov.frag48.UV.inv$x, y=pred.Pyr.17Nov.frag48.UV.inv$Estimate), color = 'grey30', size=0.5)


p.all= p.all+ geom_point(data = data.Pyr.17Nov.frag48.PAR, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2.5, position=position_jitter(width = .025, height=0.02))
p.all= p.all+ geom_point(data = data.Pyr.17Nov.frag48.UV, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2, position=position_jitter(width = .025, height=0.02))


p.all = p.all+ labs(x=expression(Concentration~(μg~"L"^{-1})), #
              y=expression(), #48~h~fragmentation~("%")
              subtitle="e) Pyrene")
p.all= p.all+ scale_y_continuous( limits = c(-0.03, 1.05), breaks = c(0, 0.25, 0.5, 0.75, 1.0), labels = c(0, 25, 50, 75, 100)) 
p.all= p.all+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))
p.all= p.all+ scale_fill_manual(values = c("seagreen", "steelblue"))
p.all= p.all+ theme(legend.position="none")
# p.all = p.all  + theme(legend.position = c(0.9, 0.9))
p.all= p.all+ scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000))
#p.all= p.all+ facet_wrap(~factor, nrow = 1)


#Rename & show plot
plot.Pyr.17Nov.frag48.all <- p.all
plot.Pyr.17Nov.frag48.all
```

```{r}
load("2017.11_Pyr_frag48_posterior_comp_EC50.RData")

p.comp.EC50 = ggplot(comp.Pyr.17Nov.frag48.EC50$posterior_data, aes(x=value))+geom_density(aes(group=model, color=model, fill=model), alpha=0.4) 
p.comp.EC50 = p.comp.EC50 + stat_pointinterval(aes(y = 0.00, x = value, group=model),.width = c(.66, .95), size=0.5)+
  theme_light()

p.comp.EC50 = p.comp.EC50 + scale_fill_manual( values = c("seagreen", "steelblue")) +
  scale_color_manual(values = c("grey","grey", "steelblue1","steelblue", "grey","grey", "grey","grey"))+theme(legend.position="none")
p.comp.EC50 = p.comp.EC50 + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))

p.comp.EC50 = p.comp.EC50 + scale_y_continuous(limits = c(-0.5, 5), name ="Posterior probability density") 
p.comp.EC50 = p.comp.EC50 + scale_x_continuous(limits = c(-1.02, 4.3), breaks = c(-1, 0, 1, 2, 3, 4), labels = c(0, 1, 10, 100, 1000, 10000)) #update breaks+labels to match the scale given by the automatic compare_posterior output
p.comp.EC50 = p.comp.EC50 + labs(x=expression(), #EC50~(μg~"L"^{-1})
               subtitle="b)")

p.comp.EC50= p.comp.EC50+ annotate("text", label = expression(Probability~of~EC[50]~difference), x = 0.55, y = 3.36, size = 2.8, colour = "grey20") #0.8 of the max y-axis limit
p.comp.EC50= p.comp.EC50+ annotate("text", label = "UVR < PAR = 49.11%", x = 0.55, y = 3.04, size = 2.4, colour = "grey20") #0.906 of the first annotation


#Rename & show plot
comp.plot.Pyr.17Nov.frag48.EC50 <- p.comp.EC50
comp.plot.Pyr.17Nov.frag48.EC50
```



## Create layouts and export

```{r}
layout.Ch4.main.frag.CR <- ggarrange(plot.Tol.19Nov.frag48.all, plot.Nap.18Dec.frag48.all, plot.1MN.19Nov.frag48.all, plot.Phe.18Nov.frag48.all, plot.Ant.17Dec.frag48.all, plot.Pyr.17Nov.frag48.all,
          ncol = 2, nrow = 3,
          widths = c(0.5, 0.5))
layout.Ch4.main.frag.CR
```


```{r}
pdf("Ch4_Main_fig_frag_CR.pdf", width = 6.69, height = 7.38) #height and width in inches
layout.Ch4.main.frag.CR
dev.off()
```






#Light treatment posterior differences
## Load files and creat plots

### Toluene
### 2019.11

No candidate models could be fitted for PAR/-UV data so no comparison was performed. 


### Naphthalene
#### 2018.12
Plot the posterior difference estimate for the UV and PAR light treatments across the treatment concentrations tested
```{r}
load("2018.12_Nap_frag48_predvals.RData")

pred.Nap.18Dec.frag48$diff_data$inv.x <- 10^pred.Nap.18Dec.frag48$diff_data$x

p.comp.diff = ggplot(pred.Nap.18Dec.frag48$diff_data) +
  geom_ribbon(aes(x=inv.x, ymin=diff.Q2.5, ymax=diff.Q97.5, fill = 'grey'), alpha=0.4) +
  geom_line(aes(x=inv.x, diff.Estimate, color="grey"), size=0.8) +
  geom_hline(yintercept = 0, color = "steelblue3", lty = 2, size=0.75)


p.comp.diff= p.comp.diff + scale_fill_manual( values = c("grey", "steelblue3")) +
                scale_color_manual(values = c("grey", "steelblue3")) 
  
p.comp.diff= p.comp.diff + theme_light() + 
                theme(legend.position="none") +
                theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))

p.comp.diff= p.comp.diff + scale_y_continuous(name = "Posterior differences estimate") 
p.comp.diff= p.comp.diff + scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000)) +
              labs(x=expression(), #Treatment~concentration~(μg~"L"^{-1})
                  y=expression(Posterior~difference~estimate),
                  subtitle="a) Naphthalene")

plot.Nap.18Dec.frag48.diff.est <- p.comp.diff
plot.Nap.18Dec.frag48.diff.est
```


### 1-methylnaphthalene
```{r}
load("2019.11_1MN_frag48_predvals.RData")

pred.1MN.19Nov.frag48$diff_data$inv.x <- 10^pred.1MN.19Nov.frag48$diff_data$x

p.comp.diff = ggplot(pred.1MN.19Nov.frag48$diff_data) +
  geom_ribbon(aes(x=inv.x, ymin=diff.Q2.5, ymax=diff.Q97.5, fill = 'grey'), alpha=0.4) +
  geom_line(aes(x=inv.x, diff.Estimate, color="grey"), size=0.8) +
  geom_hline(yintercept = 0, color = "steelblue3", lty = 2, size=0.75)


p.comp.diff= p.comp.diff + scale_fill_manual( values = c("grey", "steelblue3")) +
                scale_color_manual(values = c("grey", "steelblue3")) 
  
p.comp.diff= p.comp.diff + theme_light() + 
                theme(legend.position="none") +
                theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))

p.comp.diff= p.comp.diff + scale_y_continuous() 
p.comp.diff= p.comp.diff + scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000)) +
              labs(x=expression(), #Treatment~concentration~(μg~"L"^{-1})
                  y=expression(), #Posterior~difference~estimate
                  subtitle="b) 1-methylnaphthalene")

plot.1MN.19Nov.frag48.diff.est <- p.comp.diff
plot.1MN.19Nov.frag48.diff.est
```


### Phenanthrene
#### 2018.11
Not applicable as no candidate models could be fitted


### Anthracene
#### 2017.12
```{r}
load("2017.12_Ant_frag48_predvals.RData")

pred.Ant.17Dec.frag48$diff_data$inv.x <- 10^pred.Ant.17Dec.frag48$diff_data$x

p.comp.diff = ggplot(pred.Ant.17Dec.frag48$diff_data) +
  geom_ribbon(aes(x=inv.x, ymin=diff.Q2.5, ymax=diff.Q97.5, fill = 'grey'), alpha=0.4) +
  geom_line(aes(x=inv.x, diff.Estimate, color="grey"), size=0.8) +
  geom_hline(yintercept = 0, color = "steelblue3", lty = 2, size=0.75)


p.comp.diff= p.comp.diff + scale_fill_manual( values = c("grey", "steelblue3")) +
                scale_color_manual(values = c("grey", "steelblue3")) 
  
p.comp.diff= p.comp.diff + theme_light() + 
                theme(legend.position="none") +
                theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))

p.comp.diff= p.comp.diff + scale_y_continuous() 
p.comp.diff= p.comp.diff + scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000)) +
              labs(x=expression(Concentration~(μg~"L"^{-1})),
                  y=expression(Posterior~difference~estimate),
                  subtitle="c)")

plot.Ant.17Dec.frag48.diff.est <- p.comp.diff
plot.Ant.17Dec.frag48.diff.est
```


### Pyrene
#### 2017.12
```{r}
load("2017.11_Pyr_frag48_predvals.RData")

pred.Pyr.17Nov.frag48$diff_data$inv.x <- 10^pred.Pyr.17Nov.frag48$diff_data$x

p.comp.diff = ggplot(pred.Pyr.17Nov.frag48$diff_data) +
  geom_ribbon(aes(x=inv.x, ymin=diff.Q2.5, ymax=diff.Q97.5, fill = 'grey'), alpha=0.4) +
  geom_line(aes(x=inv.x, diff.Estimate, color="grey"), size=0.8) +
  geom_hline(yintercept = 0, color = "steelblue3", lty = 2, size=0.75)


p.comp.diff= p.comp.diff + scale_fill_manual( values = c("grey", "steelblue3")) +
                scale_color_manual(values = c("grey", "steelblue3")) 
  
p.comp.diff= p.comp.diff + theme_light() + 
                theme(legend.position="none") +
                theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))

p.comp.diff= p.comp.diff + scale_y_continuous() 
p.comp.diff= p.comp.diff + scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000)) +
              labs(x=expression(Concentration~(μg~"L"^{-1})),
                  y=expression(), #Posterior~difference~estimate
                  subtitle="d) Pyrene")

plot.Pyr.17Nov.frag48.diff.est <- p.comp.diff
plot.Pyr.17Nov.frag48.diff.est
```



## Create layout and export

```{r}
layout.Ch4.SUP.frag.2 <- ggarrange(plot.Nap.18Dec.frag48.diff.est, plot.1MN.19Nov.frag48.diff.est, plot.Ant.17Dec.frag48.diff.est, plot.Pyr.17Nov.frag48.diff.est,
          ncol = 2, nrow = 2,
          widths = c(0.5, 0.5))
layout.Ch4.SUP.frag.2
```


```{r}
pdf("Ch4_SUP_fig_frag_diff.pdf", width = 6.69, height = 4.92) #height and width in inches
layout.Ch4.SUP.frag.2
dev.off()
```



# NEC MANEC model fits
##Load files and create result plots

### Toluene
#### 2019.11
```{r}
load("2019.11_Tol_data_frag48_filtered.RData")
load("2019.11_Tol_frag48_predvals.RData")

p.NEC= ggplot()
p.NEC= p.NEC+ scale_color_manual(values = c("UVR" = "steelblue", "PAR" = "seagreen")) + theme_light()


#p.NEC= p.NEC+  geom_ribbon(aes(x=10^pred.Tol.19Nov.frag48.PAR.NEC.inv$x, ymin=pred.Tol.19Nov.frag48.PAR.NEC.inv$Q2.5, ymax=pred.Tol.19Nov.frag48.PAR.NEC.inv$Q97.5, fill="seagreen"),  alpha=0.3) #Seagreen HEX code: #2e8b57
#p.NEC= p.NEC+  scale_fill_manual(values=c("seagreen", "steelblue"))
p.NEC= p.NEC+  geom_ribbon(aes(x=10^pred.Tol.19Nov.frag48.UV.NEC.inv$x, ymin=pred.Tol.19Nov.frag48.UV.NEC.inv$Q2.5, ymax=pred.Tol.19Nov.frag48.UV.NEC.inv$Q97.5,fill="steelblue",  alpha=0.3))
#p.NEC= p.NEC+  scale_fill_manual(values="steelblue")


#p.NEC= p.NEC+ geom_line(aes(x=10^pred.Tol.19Nov.frag48.PAR.NEC.inv$x, y=pred.Tol.19Nov.frag48.PAR.NEC.inv$Estimate), color = 'grey30', size=0.5)
p.NEC= p.NEC+ geom_line(aes(x=10^pred.Tol.19Nov.frag48.UV.NEC.inv$x, y=pred.Tol.19Nov.frag48.UV.NEC.inv$Estimate), color = 'grey30', size=0.5)


p.NEC= p.NEC+ geom_point(data = data.Tol.19Nov.frag48.PAR, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2.5, position=position_jitter(width = .025, height=0.02))
p.NEC= p.NEC+ geom_point(data = data.Tol.19Nov.frag48.UV, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2, position=position_jitter(width = .025, height=0.02))


p.NEC = p.NEC+ labs(x=expression(), #Concentration~(μg~"L"^{-1})
              y=expression(48~h~ fragmentation~("%")),
              subtitle="a) Toluene")
p.NEC= p.NEC+ scale_y_continuous( limits = c(-0.03, 1.05), breaks = c(0, 0.25, 0.5, 0.75, 1.0), labels = c(0, 25, 50, 75, 100)) 
p.NEC= p.NEC+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))
p.NEC= p.NEC+ scale_fill_manual(values = c("steelblue", "seagreen"))
p.NEC= p.NEC+ theme(legend.position="none")
# p.NEC = p.NEC  + theme(legend.position = c(0.9, 0.9))
p.NEC= p.NEC+ scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000))
#p.NEC= p.NEC+ facet_wrap(~factor, nrow = 1)


#Rename & show plot
plot.Tol.19Nov.frag48.NEC <- p.NEC
plot.Tol.19Nov.frag48.NEC
```

No NEC comparison performed as no candidate models could be fitted to PAR/-UV data.


### Naphthalene
#### 2018.12
```{r}
load("2018.12_Nap_data_frag48_filtered.RData")
load("2018.12_Nap_frag48_predvals.RData")

p.NEC= ggplot()
p.NEC= p.NEC+ scale_color_manual(values = c("UVR" = "steelblue", "PAR" = "seagreen")) + theme_light()


p.NEC= p.NEC+  geom_ribbon(aes(x=10^pred.Nap.18Dec.frag48.PAR.NEC.inv$x, ymin=pred.Nap.18Dec.frag48.PAR.NEC.inv$Q2.5, ymax=pred.Nap.18Dec.frag48.PAR.NEC.inv$Q97.5, fill="seagreen"),  alpha=0.3) #Seagreen HEX code: #2e8b57
#p.NEC= p.NEC+  scale_fill_manual(values=c("seagreen", "steelblue"))
p.NEC= p.NEC+  geom_ribbon(aes(x=10^pred.Nap.18Dec.frag48.UV.NEC.inv$x, ymin=pred.Nap.18Dec.frag48.UV.NEC.inv$Q2.5, ymax=pred.Nap.18Dec.frag48.UV.NEC.inv$Q97.5,fill="steelblue",  alpha=0.3))
#p.NEC= p.NEC+  scale_fill_manual(values="steelblue")


p.NEC= p.NEC+ geom_line(aes(x=10^pred.Nap.18Dec.frag48.PAR.NEC.inv$x, y=pred.Nap.18Dec.frag48.PAR.NEC.inv$Estimate), color = 'grey30', size=0.5)
p.NEC= p.NEC+ geom_line(aes(x=10^pred.Nap.18Dec.frag48.UV.NEC.inv$x, y=pred.Nap.18Dec.frag48.UV.NEC.inv$Estimate), color = 'grey30', size=0.5)


p.NEC= p.NEC+ geom_point(data = data.Nap.18Dec.frag48.PAR, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2.5, position=position_jitter(width = .025, height=0.02))
p.NEC= p.NEC+ geom_point(data = data.Nap.18Dec.frag48.UV, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2, position=position_jitter(width = .025, height=0.02))


p.NEC = p.NEC+ labs(x=expression(), #Concentration~(μg~"L"^{-1})
              y=expression(), #48~h~ fragmentation~("%")
              subtitle="b) Naphthalene")
p.NEC= p.NEC+ scale_y_continuous( limits = c(-0.03, 1.05), breaks = c(0, 0.25, 0.5, 0.75, 1.0), labels = c(0, 25, 50, 75, 100)) 
p.NEC= p.NEC+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))
p.NEC= p.NEC+ scale_fill_manual(values = c("seagreen", "steelblue"))
p.NEC= p.NEC+ theme(legend.position="none")
# p.NEC = p.NEC  + theme(legend.position = c(0.9, 0.9))
p.NEC= p.NEC+ scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000))
#p.NEC= p.NEC+ facet_wrap(~factor, nrow = 1)


#Rename & show plot
plot.Nap.18Dec.frag48.NEC <- p.NEC
plot.Nap.18Dec.frag48.NEC
```

```{r}
load("2018.12_Nap_frag48_posterior_comp_NEC.RData")

p.comp.NEC = ggplot(comp.Nap.18Dec.frag48.NEC$posterior_data, aes(x=value))+geom_density(aes(group=model, color=model, fill=model), alpha=0.4) 
p.comp.NEC = p.comp.NEC + stat_pointinterval(aes(y=0.00, x=value, group=model),.width=c(.66, .95), size=0.5) +
  theme_light()

p.comp.NEC = p.comp.NEC + scale_fill_manual(values=c("seagreen", "steelblue"))+
  scale_color_manual(values = c("grey","grey", "steelblue1","steelblue", "grey","grey", "grey","grey")) + theme(legend.position="none")
p.comp.NEC = p.comp.NEC + theme(panel.grid.major = element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), panel.border=element_blank(), axis.line=element_line(colour="grey80"))

p.comp.NEC = p.comp.NEC + scale_y_continuous(limits = c(-0.5, 3)) 
p.comp.NEC = p.comp.NEC + scale_x_continuous(limits = c(-1.02, 4.3), breaks = c(-1, 0, 1, 2, 3, 4), labels = c(0, 1, 10, 100, 1000, 10000)) #update breaks+labels to match the scale given by the automatic compare_posterior output
p.comp.NEC = p.comp.NEC + labs(x=expression(), #Threshold~concentration~(μg~"L"^{-1})
                               y=expression(Posterior~probability~density),
                               subtitle="a) Naphthalene")

p.comp.NEC= p.comp.NEC+ annotate("text", label = expression(Probability~of~NEC~difference), x = 0.55, y = 2.4, size = 2.8, colour = "grey20") #0.8 of the max y-axis limit
p.comp.NEC= p.comp.NEC+ annotate("text", label = "UVR < PAR = 64.15%", x = 0.55, y = 2.17, size = 2.4, colour = "grey20") #0.906 of the first annotation


#Rename and show plot
comp.plot.Nap.18Dec.frag48.NEC <- p.comp.NEC
comp.plot.Nap.18Dec.frag48.NEC
```



### 1-methylnaphthalene
#### 2019.11
```{r}
load("2019.11_1MN_data_frag48_filtered.RData")
load("2019.11_1MN_frag48_predvals.RData")

p.NEC= ggplot()
p.NEC= p.NEC+ scale_color_manual(values = c("UVR" = "steelblue", "PAR" = "seagreen")) + theme_light()


p.NEC= p.NEC+  geom_ribbon(aes(x=10^pred.1MN.19Nov.frag48.PAR.NEC.inv$x, ymin=pred.1MN.19Nov.frag48.PAR.NEC.inv$Q2.5, ymax=pred.1MN.19Nov.frag48.PAR.NEC.inv$Q97.5, fill="seagreen"),  alpha=0.3) #Seagreen HEX code: #2e8b57
#p.NEC= p.NEC+  scale_fill_manual(values=c("seagreen", "steelblue"))
p.NEC= p.NEC+  geom_ribbon(aes(x=10^pred.1MN.19Nov.frag48.UV.NEC.inv$x, ymin=pred.1MN.19Nov.frag48.UV.NEC.inv$Q2.5, ymax=pred.1MN.19Nov.frag48.UV.NEC.inv$Q97.5,fill="steelblue",  alpha=0.3))
#p.NEC= p.NEC+  scale_fill_manual(values="steelblue")


p.NEC= p.NEC+ geom_line(aes(x=10^pred.1MN.19Nov.frag48.PAR.NEC.inv$x, y=pred.1MN.19Nov.frag48.PAR.NEC.inv$Estimate), color = 'grey30', size=0.5)
p.NEC= p.NEC+ geom_line(aes(x=10^pred.1MN.19Nov.frag48.UV.NEC.inv$x, y=pred.1MN.19Nov.frag48.UV.NEC.inv$Estimate), color = 'grey30', size=0.5)


p.NEC= p.NEC+ geom_point(data = data.1MN.19Nov.frag48.PAR, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2.5, position=position_jitter(width = .025, height=0.02))
p.NEC= p.NEC+ geom_point(data = data.1MN.19Nov.frag48.UV, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2, position=position_jitter(width = .025, height=0.02))


p.NEC = p.NEC+ labs(x=expression(), #Concentration~(μg~"L"^{-1})
              y=expression(48~h~ fragmentation~("%")),
              subtitle="c) 1-methylnaphthalene")
p.NEC= p.NEC+ scale_y_continuous( limits = c(-0.03, 1.05), breaks = c(0, 0.25, 0.5, 0.75, 1.0), labels = c(0, 25, 50, 75, 100)) 
p.NEC= p.NEC+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))
p.NEC= p.NEC+ scale_fill_manual(values = c("seagreen", "steelblue"))
p.NEC= p.NEC+ theme(legend.position="none")
# p.NEC = p.NEC  + theme(legend.position = c(0.9, 0.9))
p.NEC= p.NEC+ scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000))
#p.NEC= p.NEC+ facet_wrap(~factor, nrow = 1)


#Rename & show plot
plot.1MN.19Nov.frag48.NEC <- p.NEC
plot.1MN.19Nov.frag48.NEC
```

```{r}
load("2019.11_1MN_frag48_posterior_comp_NEC.RData")

p.comp.NEC = ggplot(comp.1MN.19Nov.frag48.NEC$posterior_data, aes(x=value))+geom_density(aes(group=model, color=model, fill=model), alpha=0.4) 
p.comp.NEC = p.comp.NEC + stat_pointinterval(aes(y=0.00, x=value, group=model),.width=c(.66, .95), size=0.5) +
  theme_light()

p.comp.NEC = p.comp.NEC + scale_fill_manual(values=c("seagreen", "steelblue"))+
  scale_color_manual(values = c("grey","grey", "steelblue1","steelblue", "grey","grey", "grey","grey")) + theme(legend.position="none")
p.comp.NEC = p.comp.NEC + theme(panel.grid.major = element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), panel.border=element_blank(), axis.line=element_line(colour="grey80"))

p.comp.NEC = p.comp.NEC + scale_y_continuous(limits = c(-0.5, 2)) 
p.comp.NEC = p.comp.NEC + scale_x_continuous(limits = c(-1.02, 4.3), breaks = c(-1, 0, 1, 2, 3, 4), labels = c(0, 1, 10, 100, 1000, 10000)) #update breaks+labels to match the scale given by the automatic compare_posterior output
p.comp.NEC = p.comp.NEC + labs(x=expression(), #Threshold~concentration~(μg~"L"^{-1})
                               y=expression(), #Posterior~probability~density
                               subtitle="b) 1-methylnaphthalene")

p.comp.NEC= p.comp.NEC+ annotate("text", label = expression(Probability~of~NEC~difference), x = 0.55, y = 1.6, size = 2.8, colour = "grey20") #0.8 of the max y-axis limit
p.comp.NEC= p.comp.NEC+ annotate("text", label = "UVR < PAR = 51.03%", x = 0.55, y = 1.45, size = 2.4, colour = "grey20") #0.906 of the first annotation


#Rename and show plot
comp.plot.1MN.19Nov.frag48.NEC <- p.comp.NEC
comp.plot.1MN.19Nov.frag48.NEC
```


### Phenanthrene
#### 2018.11
```{r}
load("2018.11_Phe_data_frag48_filtered.RData")
#load("2018.11_Phe_frag48_predvals.RData")

p.all= ggplot()
p.all= p.all+ scale_color_manual(values = c("UVR" = "steelblue", "PAR" = "seagreen")) + theme_light()


#p.all= p.all+  geom_ribbon(aes(x=10^pred.Phe.18Nov.frag48.PAR.inv$x, ymin=pred.Phe.18Nov.frag48.PAR.inv$Q2.5, ymax=pred.Phe.18Nov.frag48.PAR.inv$Q97.5, fill="seagreen"),  alpha=0.3) #Seagreen HEX code: #2e8b57
#p.all= p.all+  scale_fill_manual(values=c("seagreen", "steelblue"))
#p.all= p.all+  geom_ribbon(aes(x=10^pred.Phe.18Nov.frag48.UV.inv$x, ymin=pred.Phe.18Nov.frag48.UV.inv$Q2.5, ymax=pred.Phe.18Nov.frag48.UV.inv$Q97.5, fill="steelblue",  alpha=0.3))
#p.all= p.all+  scale_fill_manual(values="steelblue")


#p.all= p.all+ geom_line(aes(x=10^pred.Phe.18Nov.frag48.PAR.inv$x, y=pred.Phe.18Nov.frag48.PAR.inv$Estimate), color = 'grey30', size=0.5)
#p.all= p.all+ geom_line(aes(x=10^pred.Phe.18Nov.frag48.UV.inv$x, y=pred.Phe.18Nov.frag48.UV.inv$Estimate), color = 'grey30', size=0.5)


p.all= p.all+ geom_point(data = data.Phe.18Nov.frag48.PAR, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2.5, position=position_jitter(width = .025, height=0.02))
p.all= p.all+ geom_point(data = data.Phe.18Nov.frag48.UV, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2, position=position_jitter(width = .025, height=0.02))


p.all = p.all+ labs(x=expression(), #Concentration~(μg~"L"^{-1})
              y=expression(), #48~h~fragmentation~("%")
              subtitle="d) Phenanthrene")
p.all= p.all+ scale_y_continuous( limits = c(-0.03, 1.05), breaks = c(0, 0.25, 0.5, 0.75, 1.0), labels = c(0, 25, 50, 75, 100)) 
p.all= p.all+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))
p.all= p.all+ scale_fill_manual(values = c("seagreen", "steelblue"))
p.all= p.all+ theme(legend.position="none")
# p.all = p.all  + theme(legend.position = c(0.9, 0.9))
p.all= p.all+ scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000))
#p.all= p.all+ facet_wrap(~factor, nrow = 1)


#Rename & show plot
plot.Phe.18Nov.frag48.all <- p.all
plot.Phe.18Nov.frag48.all
```


### Anthracene
#### 2017.12
```{r}
load("2017.12_Ant_data_frag48_filtered.RData")
load("2017.12_Ant_frag48_predvals.RData")

p.NEC= ggplot()
p.NEC= p.NEC+ scale_color_manual(values = c("UVR" = "steelblue", "PAR" = "seagreen")) + theme_light()


p.NEC= p.NEC+  geom_ribbon(aes(x=10^pred.Ant.17Dec.frag48.PAR.inv.NEC$x, ymin=pred.Ant.17Dec.frag48.PAR.inv.NEC$Q2.5, ymax=pred.Ant.17Dec.frag48.PAR.inv.NEC$Q97.5, fill="seagreen"),  alpha=0.3) #Seagreen HEX code: #2e8b57
#p.NEC= p.NEC+  scale_fill_manual(values=c("seagreen", "steelblue"))
p.NEC= p.NEC+  geom_ribbon(aes(x=10^pred.Ant.17Dec.frag48.UV.inv.NEC$x, ymin=pred.Ant.17Dec.frag48.UV.inv.NEC$Q2.5, ymax=pred.Ant.17Dec.frag48.UV.inv.NEC$Q97.5,fill="steelblue",  alpha=0.3))
#p.NEC= p.NEC+  scale_fill_manual(values="steelblue")


p.NEC= p.NEC+ geom_line(aes(x=10^pred.Ant.17Dec.frag48.PAR.inv.NEC$x, y=pred.Ant.17Dec.frag48.PAR.inv.NEC$Estimate), color = 'grey30', size=0.5)
p.NEC= p.NEC+ geom_line(aes(x=10^pred.Ant.17Dec.frag48.UV.inv.NEC$x, y=pred.Ant.17Dec.frag48.UV.inv.NEC$Estimate), color = 'grey30', size=0.5)


p.NEC= p.NEC+ geom_point(data = data.Ant.17Dec.frag48.PAR, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2.5, position=position_jitter(width = .025, height=0.02))
p.NEC= p.NEC+ geom_point(data = data.Ant.17Dec.frag48.UV, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2, position=position_jitter(width = .025, height=0.02))


p.NEC = p.NEC+ labs(x=expression(Concentration~(μg~"L"^{-1})),
              y=expression(48~h~ fragmentation~("%")),
              subtitle="e) Anthracene")
p.NEC= p.NEC+ scale_y_continuous( limits = c(-0.03, 1.05), breaks = c(0, 0.25, 0.5, 0.75, 1.0), labels = c(0, 25, 50, 75, 100)) 
p.NEC= p.NEC+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))
p.NEC= p.NEC+ scale_fill_manual(values = c("seagreen", "steelblue"))
p.NEC= p.NEC+ theme(legend.position="none")
# p.NEC = p.NEC  + theme(legend.position = c(0.9, 0.9))
p.NEC= p.NEC+ scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000))
#p.NEC= p.NEC+ facet_wrap(~factor, nrow = 1)


#Rename & show plot
plot.Ant.17Dec.frag48.NEC <- p.NEC
plot.Ant.17Dec.frag48.NEC
```

```{r}
load("2017.12_Ant_frag48_posterior_comp_NEC.RData")

p.comp.NEC = ggplot(comp.Ant.17Dec.frag48.NEC$posterior_data, aes(x=value))+geom_density(aes(group=model, color=model, fill=model), alpha=0.4) 
p.comp.NEC = p.comp.NEC + stat_pointinterval(aes(y=0.00, x=value, group=model),.width=c(.66, .95), size=0.5) +
  theme_light()

p.comp.NEC = p.comp.NEC + scale_fill_manual(values=c("seagreen", "steelblue"))+
  scale_color_manual(values = c("grey","grey", "steelblue1","steelblue", "grey","grey", "grey","grey")) + theme(legend.position="none")
p.comp.NEC = p.comp.NEC + theme(panel.grid.major = element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), panel.border=element_blank(), axis.line=element_line(colour="grey80"))

p.comp.NEC = p.comp.NEC + scale_y_continuous(limits = c(-0.5, 4)) 
p.comp.NEC = p.comp.NEC + scale_x_continuous(limits = c(-1.02, 4.3), breaks = c(-1, 0, 1, 2, 3, 4), labels = c(0, 1, 10, 100, 1000, 10000)) #update breaks+labels to match the scale given by the automatic compare_posterior output
p.comp.NEC = p.comp.NEC + labs(x=expression(Concentration~(μg~"L"^{-1})),
                               y=expression(Posterior~probability~density),
                               subtitle="c) Anthracene")

p.comp.NEC= p.comp.NEC+ annotate("text", label = expression(Probability~of~NEC~difference), x = 0.55, y = 3.2, size = 2.8, colour = "grey20") #0.8 of the max y-axis limit
p.comp.NEC= p.comp.NEC+ annotate("text", label = "UVR < PAR = 35.38%", x = 0.55, y = 2.9, size = 2.4, colour = "grey20") #0.906 of the first annotation


#Rename and show plot
comp.plot.Ant.17Dec.frag48.NEC <- p.comp.NEC
comp.plot.Ant.17Dec.frag48.NEC
```



### Pyrene
#### 2017.12
```{r}
load("2017.11_Pyr_data_frag48_filtered.RData")
load("2017.11_Pyr_frag48_predvals.RData")

p.NEC= ggplot()
p.NEC= p.NEC+ scale_color_manual(values = c("UVR" = "steelblue", "PAR" = "seagreen")) + theme_light()


p.NEC= p.NEC+  geom_ribbon(aes(x=10^pred.Pyr.17Nov.frag48.PAR.NEC.inv$x, ymin=pred.Pyr.17Nov.frag48.PAR.NEC.inv$Q2.5, ymax=pred.Pyr.17Nov.frag48.PAR.NEC.inv$Q97.5, fill="seagreen"),  alpha=0.3) #Seagreen HEX code: #2e8b57
#p.NEC= p.NEC+  scale_fill_manual(values=c("seagreen", "steelblue"))
p.NEC= p.NEC+  geom_ribbon(aes(x=10^pred.Pyr.17Nov.frag48.UV.NEC.inv$x, ymin=pred.Pyr.17Nov.frag48.UV.NEC.inv$Q2.5, ymax=pred.Pyr.17Nov.frag48.UV.NEC.inv$Q97.5,fill="steelblue",  alpha=0.3))
#p.NEC= p.NEC+  scale_fill_manual(values="steelblue")


p.NEC= p.NEC+ geom_line(aes(x=10^pred.Pyr.17Nov.frag48.PAR.NEC.inv$x, y=pred.Pyr.17Nov.frag48.PAR.NEC.inv$Estimate), color = 'grey30', size=0.5)
p.NEC= p.NEC+ geom_line(aes(x=10^pred.Pyr.17Nov.frag48.UV.NEC.inv$x, y=pred.Pyr.17Nov.frag48.UV.NEC.inv$Estimate), color = 'grey30', size=0.5)


p.NEC= p.NEC+ geom_point(data = data.Pyr.17Nov.frag48.PAR, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2.5, position=position_jitter(width = .025, height=0.02))
p.NEC= p.NEC+ geom_point(data = data.Pyr.17Nov.frag48.UV, aes(x = raw.x, y = prop, colour=factor(factor), shape = factor(factor), alpha = 0.3), size = 2, position=position_jitter(width = .025, height=0.02))


p.NEC = p.NEC+ labs(x=expression(Concentration~(μg~"L"^{-1})),
              y=expression(), #48~h~ fragmentation~("%")
              subtitle="f) Pyrene")
p.NEC= p.NEC+ scale_y_continuous( limits = c(-0.03, 1.05), breaks = c(0, 0.25, 0.5, 0.75, 1.0), labels = c(0, 25, 50, 75, 100)) 
p.NEC= p.NEC+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), panel.border = element_blank(), axis.line = element_line(colour = "grey80"))
p.NEC= p.NEC+ scale_fill_manual(values = c("seagreen", "steelblue"))
p.NEC= p.NEC+ theme(legend.position="none")
# p.NEC = p.NEC  + theme(legend.position = c(0.9, 0.9))
p.NEC= p.NEC+ scale_x_continuous(limits = c(0.09, 30000), trans="log10", breaks = c(0.1, 1, 10, 100, 1000, 10000), labels = c(0, 1, 10, 100, 1000, 10000))
#p.NEC= p.NEC+ facet_wrap(~factor, nrow = 1)


#Rename & show plot
plot.Pyr.17Nov.frag48.NEC <- p.NEC
plot.Pyr.17Nov.frag48.NEC
```

```{r}
load("2017.11_Pyr_frag48_posterior_comp_NEC.RData")

p.comp.NEC = ggplot(comp.Pyr.17Nov.frag48.NEC$posterior_data, aes(x=value))+geom_density(aes(group=model, color=model, fill=model), alpha=0.4) 
p.comp.NEC = p.comp.NEC + stat_pointinterval(aes(y=0.00, x=value, group=model),.width=c(.66, .95), size=0.5) +
  theme_light()

p.comp.NEC = p.comp.NEC + scale_fill_manual(values=c("seagreen", "steelblue"))+
  scale_color_manual(values = c("grey","grey", "steelblue1","steelblue", "grey","grey", "grey","grey")) + theme(legend.position="none")
p.comp.NEC = p.comp.NEC + theme(panel.grid.major = element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), panel.border=element_blank(), axis.line=element_line(colour="grey80"))

p.comp.NEC = p.comp.NEC + scale_y_continuous(limits = c(-0.5, 3)) 
p.comp.NEC = p.comp.NEC + scale_x_continuous(limits = c(-1.02, 4.3), breaks = c(-1, 0, 1, 2, 3, 4), labels = c(0, 1, 10, 100, 1000, 10000)) #update breaks+labels to match the scale given by the automatic compare_posterior output
p.comp.NEC = p.comp.NEC + labs(x=expression(Concentration~(μg~"L"^{-1})),
                               y=expression(),
                               subtitle="d) Pyrene")

p.comp.NEC= p.comp.NEC+ annotate("text", label = expression(Probability~of~NEC~difference), x = 0.55, y = 2.44, size = 2.8, colour = "grey20") #0.8 of the max y-axis limit
p.comp.NEC= p.comp.NEC+ annotate("text", label = "UVR < PAR = 68.27%", x = 0.55, y = 2.21, size = 2.4, colour = "grey20") #0.906 of the first annotation


#Rename and show plot
comp.plot.Pyr.17Nov.frag48.NEC <- p.comp.NEC
comp.plot.Pyr.17Nov.frag48.NEC
```




## Create layouts and export

```{r}
layout.Ch4.SUP.frag.NEC.CR <- ggarrange(plot.Tol.19Nov.frag48.NEC, plot.Nap.18Dec.frag48.NEC, plot.1MN.19Nov.frag48.NEC, plot.Phe.18Nov.frag48.all, plot.Ant.17Dec.frag48.all, plot.Pyr.17Nov.frag48.NEC,
          ncol = 2, nrow = 3,
          widths = c(0.5, 0.5))
layout.Ch4.SUP.frag.NEC.CR
```


```{r}
pdf("Ch4_SUP_fig_frag_NEC_CR.pdf", width = 6.69, height = 7.38) #height and width in inches
layout.Ch4.SUP.frag.NEC.CR
dev.off()
```



```{r}
layout.Ch4.SUP.frag.NEC.comp <- ggarrange(comp.plot.Nap.18Dec.frag48.NEC, comp.plot.1MN.19Nov.frag48.NEC, comp.plot.Ant.17Dec.frag48.NEC, comp.plot.Pyr.17Nov.frag48.NEC,
          ncol = 2, nrow = 2,
          widths = c(0.5, 0.5))
layout.Ch4.SUP.frag.NEC.comp
```


```{r}
pdf("Ch4_SUP_fig_frag_NEC_comp.pdf", width = 8.92, height = 9.84) #height and width in inches
layout.Ch4.SUP.frag.NEC.comp
dev.off()
```

